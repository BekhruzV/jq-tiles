(function(){function e(e,t,n){var r=(new Array(++t-e)).join(".").split(".").map(function(t,n){return e+n});return n?r.map(function(e){return[Math.random(),e]}).sort().map(function(e){return e[1]}):r}function t(e){return $.Deferred(function(t){setTimeout(t.resolve,e)})}$.fn.tiles=function(n){var r=$.extend({x:4,y:4,rand:!1,speed:400,cssSpeed:300,effect:"default",reverse:!1,limit:!1,rewind:!1},n);return $("body").addClass("tiles-preload"),$(window).load(function(){$("body").removeClass("tiles-preload")}),this.each(function(){var n=$(this),i="tiles-"+r.effect,s=r.x*r.y;n.is("img")||$.error("Selector can only contain images.");var u=[],a;(new Array(s)).join(".").split(".").forEach(function(e,t){u.push('<div class="tiles-tile '+i+'-normal"/>')}),a=$(u.join(""));var f=$('<div class="tiles-wrap"/>');n.one("load",function(){var e=n.width(),t=n.height();n.wrap(f.width(e).height(t)),a.insertAfter(n),a.css({width:e/r.x,height:t/r.y,backgroundImage:"url("+n.attr("src")+")"}),a.each(function(){var e=$(this),t=e.position();e.css("backgroundPosition",-t.left+"px "+ -t.top+"px")})}),n[0].complete&&n.trigger("load"),n.on("toggleTiles",function(u,f){var l=~~(r.speed/s),c=e(0,s,r.rand);if(r.limit){var h=c.length/(100/r.limit);r.reverse?c.splice(0,h):c.splice(h,c.length)}(r.reverse?c.reverse():c).forEach(function(e,n){function s(){a.eq(e).toggleClass(i+"-toggle")}t(n*l).then(s);if(r.rewind){var u=n*l+r.cssSpeed/(100/r.rewind);t(u).then(s)}}),f=f||$.noop,t(r.speed).then(f(a,n))}),a.addClass("tiles-x"+r.x+" tiles-y"+r.y),a.filter(":odd").addClass("tiles-odd"),a.filter(":even").addClass("tiles-even"),n.hide()})}})();