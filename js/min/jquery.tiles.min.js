(function(e,t,n){function s(t,n){this.opts=e.extend({},r,n),this.klass="tiles-"+this.opts.effect,this.klassNormal=this.klass+"-normal",this.klassAnim=this.klass+"-anim",this.n_tiles=this.opts.x*this.opts.y,this.$container=e(t),this.$images=this.$container.find("img"),this.$descriptions=this.$container.find("p"),this.interval=null,this.$tiles=null,this.$navLinks=null,this.opts.rewind&&(this.opts.fade=!0),this._init()}var r={x:4,y:4,slider:!1,effect:"default",fade:!1,random:!1,reverse:!1,limit:!1,rewind:!1,auto:!1,loop:!0,slideSpeed:3500,tileSpeed:1e3,cssSpeed:300,nav:!0,navWrap:null,beforeChange:e.noop,afterChange:e.noop},i={range:function(e,t,n){var r=(new Array(++t-e)).join(".").split(".").map(function(t,n){return e+n});return n?r.map(function(e){return[Math.random(),e]}).sort().map(function(e){return e[1]}):r}};s.prototype={_init:function(){var n=this,r=n.opts;if(!n.$images.length)return!1;n.$container.addClass("tiles-slider-wrap tiles-slider-"+r.effect+" tiles-slider-s"+r.cssSpeed),n.$images.each(function(){n._generateTiles(e(this))}),n.$wraps=n.$container.find(".tiles-wrap").detach(),n.$wraps.first().addClass("tiles-wrap-current").appendTo(n.$container),n._addNav(),n.$navLinks=e(".tiles-nav a"),n._setupDescriptions(),e("body").addClass("tiles-preload"),e(t).load(function(){e("body").removeClass("tiles-preload")}),r.auto&&n.start()},_addNav:function(){var t=this,n=t.opts,r=e(n.navWrap||"<div/>").addClass("tiles-nav"),i=[],s;for(var o=1;o<t.$wraps.length+1;o++)i.push('<a href="#">'+o+"</a>");s=e(i.join("")),s.click(function(n){var r=e(this),i=+r.text()-1;t._updateNav(),t._navigate(i,e.noop),n.preventDefault()}),s.first().addClass("tiles-nav-active"),n.nav&&(n.navWrap?r.append(s):(t.$container.append(r.append(s)),r.css("margin-left","-"+r.outerWidth()/2+"px")))},_updateNav:function(){this.interval&&this.stop().start(),this.$navLinks.removeClass("tiles-nav-active").eq(this._getCurrentIdx()).addClass("tiles-nav-active")},_setupDescriptions:function(){this.$descriptions.addClass("tiles-description").first().addClass("tiles-description-active")},_showOrHideDescription:function(e){this.$descriptions.removeClass("tiles-description-active").eq(this._getCurrentIdx()).toggleClass("tiles-description-active",e)},_generateTiles:function(t){var n=this,r=n.opts,i=[],s;for(var o=0;o<n.n_tiles;o++)i.push('<div class="tiles-tile '+n.klassNormal+'"/>');s=e(i.join("")),s.addClass("tiles-x"+r.x+" tiles-y"+r.y).filter(":odd").addClass("tiles-odd").end().filter(":even").addClass("tiles-even"),s.css({width:n.$container.width()/r.x,height:n.$container.height()/r.y,backgroundImage:"url("+t.attr("src")+")"}),e('<div class="tiles-wrap"/>').append(s).insertAfter(t.hide()),s.each(function(){var t=e(this),n=t.position();t.css("backgroundPosition",-n.left+"px "+ -n.top+"px")})},_animateTiles:function(t,n){n=n||e.noop;var r=this,s=r.opts,o=i.range(0,r.n_tiles,s.random),u=Math.floor(s.tileSpeed/r.n_tiles),a=o.length/(100/s.limit),f=r.n_tiles>1?s.tileSpeed+s.cssSpeed:s.cssSpeed,l=t.find(".tiles-tile");s.reverse&&(o=o.reverse()),s.limit&&(s.reverse?o.splice(0,a):o.splice(a,o.length)),o.forEach(function(e,t){var n=l.eq(e),i=t*u;setTimeout(function(){n.addClass(r.klassAnim)},i),s.rewind&&(i+=s.cssSpeed/(100/s.rewind),setTimeout(function(){n.removeClass(r.klassAnim)},i))}),setTimeout(n,f)},_resetTiles:function(e){e.find(".tiles-tile").removeClass(this.klassAnim)},_getCurrentWrap:function(){return this.$wraps.filter(".tiles-wrap-current")},_getCurrentIdx:function(){return this.$wraps.index(this._getCurrentWrap())},_navigate:function(e,t){var n=this,r=n.opts,i=n._getCurrentWrap(),s=n.$wraps.eq(e);return e===n._getCurrentIdx()?!1:(n.$container.find(".tiles-wrap").removeClass("tiles-wrap-current"),s.addClass("tiles-wrap-current").prependTo(n.$container),r.fade&&s.fadeOut(1).fadeIn(r.tileSpeed),r.rewind&&i.fadeIn(1).delay(r.tileSpeed/2).fadeOut(r.tileSpeed),n._animateTiles(i,function(){i.remove(),n._resetTiles(i),n._showOrHideDescription(!0),t(),r.afterChange()}),r.beforeChange(),n._updateNav(),n._showOrHideDescription(!1),this)},prev:function(t){var n=this,r=n._getCurrentWrap(),i=r.is(n.$wraps.first()),s=i?n.$wraps.length-1:n._getCurrentIdx()-1;return this._navigate(s,t||e.noop)},next:function(t){var n=this,r=n._getCurrentWrap(),i=r.is(n.$wraps.last()),s=i?0:n._getCurrentIdx()+1;return this._navigate(s,t||e.noop)},start:function(){var e=this,t=e.opts,n=t.slideSpeed*(e.$wraps.length-1)+t.tileSpeed;return e.interval&&e.stop().next(),e.interval=setInterval(function(){e.next()},t.slideSpeed),t.loop||setTimeout(function(){e.stop()},n),this},stop:function(){return clearInterval(this.interval),this.interval=!1,this}},e.fn.tilesSlider=function(t){var n=Array.prototype.slice.call(arguments,1);return this.each(function(){if(typeof t=="string"){var r=e.data(this,"tiles-slider");r[t].apply(r,n)}else e.data(this,"tiles-slider")||e.data(this,"tiles-slider",new s(this,t))})}})(jQuery,window);